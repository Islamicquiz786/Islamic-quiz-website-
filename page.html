<!doctype html>
<html lang="en">    
<head>    
  <meta charset="UTF-8">    
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">    
  <title>Islamic Quiz Earning Platform - Complete Registration</title>    
  <link rel="preconnect" href="https://fonts.googleapis.com">  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>  
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">  
  <style>    
    * {    
      margin: 0;    
      padding: 0;    
      box-sizing: border-box;    
      font-family: 'Orbitron', sans-serif;    
    }    
    body, html {  
      height: 100%;  
      width: 100%;  
      overflow-x: hidden;  
    }  
      
    body {    
      min-height: 100vh;  
      background: url('https://github.com/Islamicquiz786/Sahil-Images-/raw/main/ee4300b6-1a52-426c-97e2-634d0ca398a7.jpeg') no-repeat center center fixed;    
      background-size: cover;    
      display: flex;    
      justify-content: center;    
      align-items: center;    
      position: relative;    
    }    

    .overlay {    
      position: absolute;    
      inset: 0;    
      background: rgba(0, 0, 0, 0.65);    
      backdrop-filter: blur(10px);    
      z-index: 1;    
    }    

    .register-box {    
      position: relative;    
      z-index: 10;    
      background: rgba(255, 255, 255, 0.05);    
      border: 2px solid rgba(255, 255, 255, 0.2);    
      border-radius: 20px;    
      padding: 25px;    
      width: 95%;  
      max-width: 400px;  
      box-shadow: 0 0 25px #00ffe5;    
      animation: glow 3s infinite alternate;    
      margin: 20px 0;  
    }    

    @keyframes glow {    
      from { box-shadow: 0 0 15px #00ffe5; }    
      to { box-shadow: 0 0 30px #00ffe5, 0 0 60px #00ffe5; }    
    }    

    .register-box h2 {    
      color: #00ffe5;    
      text-align: center;    
      margin-bottom: 20px;    
      text-shadow: 0 0 10px #00ffe5;    
      font-size: 1.5rem;  
    }    

    .register-box input,    
    .register-box select {    
      width: 100%;    
      margin-bottom: 15px;    
      padding: 12px;    
      border: none;    
      border-radius: 8px;    
      background: rgba(255, 255, 255, 0.1);    
      color: #fff;    
      font-size: 14px;    
      transition: 0.3s;    
    }    

    .register-box input::placeholder {    
      color: #ccc;    
    }    

    .register-box input:focus,    
    .register-box select:focus {    
      outline: none;    
      background: rgba(255, 255, 255, 0.2);    
      box-shadow: 0 0 10px #00ffe5;    
    }    

    .register-box button {    
      width: 100%;    
      padding: 12px;    
      font-size: 16px;    
      background: #00ffe5;    
      color: #000;    
      border: none;    
      border-radius: 8px;    
      cursor: pointer;    
      box-shadow: 0 0 15px #00ffe5, 0 0 40px #00ffe5 inset;    
      transition: 0.3s ease-in-out;    
      margin-top: 10px;  
    }    

    .register-box button:hover {    
      background: #000;    
      color: #00ffe5;    
      box-shadow: 0 0 20px #00ffe5, 0 0 60px #00ffe5 inset;    
    }    

    .register-box label {    
      color: #00ffe5;    
      font-size: 14px;    
      margin-bottom: 6px;    
      display: block;    
      text-shadow: 0 0 5px #00ffe5;    
    }    

    .error-message {    
      color: #ff4b4b;    
      font-size: 12px;    
      text-align: center;    
      margin-top: -10px;    
      margin-bottom: 10px;    
      text-shadow: 0 0 5px #ff0000;    
      display: none;    
    }    

    .success-message {    
      color: #39ff14;    
      text-align: center;    
      margin-bottom: 15px;    
      text-shadow: 0 0 5px #39ff14;    
      display: none;    
      font-size: 14px;  
      line-height: 1.4;  
    }    

    .login-link {    
      text-align: center;    
      margin-top: 20px;    
      font-size: 14px;    
      color: #00ffe5;    
    }    

    .login-link a {    
      color: #39ff14;    
      font-weight: bold;    
      text-decoration: none;    
      text-shadow: 0 0 5px #39ff14;    
    }  

    .back-link {    
      text-align: center;    
      margin-top: 20px;    
      font-size: 14px;    
      color: #00ffe5;    
    }    

    .back-link a {    
      color: #39ff14;    
      font-weight: bold;    
      text-decoration: none;    
      text-shadow: 0 0 5px #39ff14;    
    }  
      
    .islamic-verse {  
      text-align: center;  
      color: #00ffe5;  
      margin-top: 20px;  
      font-size: 14px;  
      line-height: 1.6;  
      text-shadow: 0 0 5px #00ffe5;  
    }  
      
    .processing-message {
      color: #00ffe5;
      text-align: center;
      margin: 15px 0;
      text-shadow: 0 0 5px #00ffe5;
      display: none;
      font-size: 14px;
    }
      
    @media (max-width: 480px) {  
      .register-box {  
        padding: 20px 15px;  
      }  
        
      .register-box h2 {  
        font-size: 1.3rem;  
      }  
        
      .register-box input,  
      .register-box select {  
        padding: 10px;  
        font-size: 13px;  
      }  
    }
  </style>    
</head>    
<body>    
  <div class="overlay"></div>    
  <div class="register-box">    
    <h2>Complete Registration</h2>    
    <div id="successMessage" class="success-message"></div>    
    <form id="completeForm">    
      <label for="password">Password (5-10 Characters)</label>    
      <input type="password" id="password" minlength="5" maxlength="10" required placeholder="Enter password (5-10 characters)">    
      <div id="passwordError" class="error-message"></div>    
      
      <label for="email">Email (Gmail)</label>    
      <input type="email" id="email" required placeholder="Enter your Gmail">    
      <div id="emailError" class="error-message"></div>    
      
      <button type="submit">Complete Registration</button>    
    </form>    
    <div class="back-link">    
      <a href="register.html">← Back to Previous Step</a>    
    </div>
    <div class="login-link">    
      Already have an account? <a href="index.html">Login Here</a>    
    </div>  
    <div class="islamic-verse">  
      ﴿ وَقُلْ رَبِّ زِدْنِي عِلْمًا ﴾<br>  
      اور دعا کرو: اے میرے رب! میرے علم میں اضافہ فرما۔<br>  
      (سورۃ طٰہٰ - آیت 114)  
    </div>
  </div>    

  <!-- Firebase Integration -->        
  <script type="module">    
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";    
    import {   
      getAuth,   
      createUserWithEmailAndPassword,   
      sendEmailVerification,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";    
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";    
    import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";    
  
    // Your Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBasuAzvAlaVAayEdDU9bB9wvUzG7fVuAg",
      authDomain: "islamic-quiz-website.firebaseapp.com",
      databaseURL: "https://islamic-quiz-website-default-rtdb.firebaseio.com",
      projectId: "islamic-quiz-website",
      storageBucket: "islamic-quiz-website.appspot.com",
      messagingSenderId: "517259698394",
      appId: "1:517259698394:web:36094d03187da81685e3"
    };

    try {
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);    
      const auth = getAuth(app);    
      const database = getDatabase(app);    
      const storage = getStorage(app);    
  
      // Check if we have registration data
      const registrationData = JSON.parse(localStorage.getItem('registrationData'));
      if (!registrationData) {
        window.location.href = "register.html";
      }

      // Real-time validation for password (5-10 characters)  
      document.getElementById('password').addEventListener('input', function(e) {  
        if (this.value.length > 10) {  
          this.value = this.value.slice(0, 10);  
          document.getElementById('passwordError').textContent = 'Password must be between 5-10 characters';  
          document.getElementById('passwordError').style.display = 'block';  
        } else {  
          document.getElementById('passwordError').style.display = 'none';  
        }  
      });  
  
      document.getElementById("completeForm").addEventListener("submit", async (e) => {    
        e.preventDefault();    
            
        // Reset error messages    
        document.querySelectorAll('.error-message').forEach(el => {    
          el.style.display = 'none';    
          el.textContent = '';    
        });    
            
        // Get form values    
        const password = document.getElementById("password").value;    
        const email = document.getElementById("email").value.trim();    
        const registrationData = JSON.parse(localStorage.getItem('registrationData'));    
        const screenshotBase64 = localStorage.getItem('paymentScreenshot');    
            
        // Validate password (5-10 characters)  
        if (password.length < 5 || password.length > 10) {  
          document.getElementById("passwordError").textContent = "Password must be between 5-10 characters";  
          document.getElementById("passwordError").style.display = "block";  
          return;  
        }  
            
        try {    
          // Show processing message
          const processingMsg = document.createElement('div');
          processingMsg.className = 'processing-message';
          processingMsg.textContent = 'Processing your registration... Please wait.';
          processingMsg.style.display = 'block';
          document.getElementById("completeForm").appendChild(processingMsg);
          
          // Disable submit button during processing
          const submitBtn = document.querySelector('#completeForm button[type="submit"]');
          submitBtn.disabled = true;
          submitBtn.textContent = 'Processing...';
          
          // Create user with Firebase Auth    
          const userCredential = await createUserWithEmailAndPassword(auth, email, password);    
          const user = userCredential.user;    
              
          // Send email verification  
          await sendEmailVerification(user);  
              
          // Upload payment screenshot if exists    
          let screenshotUrl = "";    
          if (screenshotBase64 && registrationData.hasScreenshot) {    
            const screenshotBlob = await fetch(screenshotBase64).then(res => res.blob());  
            const screenshotRef = storageRef(storage, `payment_screenshots/${user.uid}/payment_${Date.now()}.jpg`);    
            await uploadBytes(screenshotRef, screenshotBlob);    
            screenshotUrl = await getDownloadURL(screenshotRef);    
          }    
              
          // Save user data to Realtime Database    
          await set(ref(database, 'users/' + user.uid), {    
            username: registrationData.username,    
            email: email,    
            whatsapp: registrationData.whatsapp,    
            plan: registrationData.plan,    
            paymentMethod: registrationData.payment,    
            accountNumber: registrationData.accountNumber || "",    
            accountName: registrationData.accountName || "",    
            paymentScreenshot: screenshotUrl,    
            registrationDate: new Date().toISOString(),    
            status: "pending",    
            balance: 0,  
            emailVerified: false  
          });    
              
          // Show success message    
          document.getElementById("successMessage").innerHTML = `  
            <h3>📩 Verification Email Sent!</h3>  
            <p>A verification link has been sent to your email (${email}).</p>  
            <p>Please check your inbox and verify your email address to complete registration.</p>  
            <p><strong>Note:</strong> Your account will be fully activated after admin verification.</p>  
            <p>You will be redirected to login page shortly...</p>  
          `;    
          document.getElementById("successMessage").style.display = "block";    
          document.getElementById("completeForm").style.display = "none";    
              
          // Remove processing message
          processingMsg.remove();
              
          // Clear stored data
          localStorage.removeItem('registrationData');
          localStorage.removeItem('paymentScreenshot');
              
          // Redirect to login page after 1 minute
          setTimeout(() => {
            window.location.href = "index.html";
          }, 60000);
              
        } catch (error) {    
          console.error("Registration error:", error);  
          let errorMessage = "Registration failed!";    
          switch (error.code) {    
            case "auth/email-already-in-use":    
              errorMessage = "Email is already registered (1 account per email allowed)";    
              document.getElementById("emailError").textContent = errorMessage;    
              document.getElementById("emailError").style.display = "block";    
              break;    
            case "auth/invalid-email":    
              errorMessage = "Invalid email address";    
              document.getElementById("emailError").textContent = errorMessage;    
              document.getElementById("emailError").style.display = "block";    
              break;    
            case "auth/weak-password":    
              errorMessage = "Password must be at least 6 characters";    
              document.getElementById("passwordError").textContent = errorMessage;    
              document.getElementById("passwordError").style.display = "block";    
              break;    
            default:    
              document.getElementById("emailError").textContent = errorMessage + ": " + error.message;    
              document.getElementById("emailError").style.display = "block";    
          }    
          
          // Re-enable submit button if error occurs
          const submitBtn = document.querySelector('#completeForm button[type="submit"]');
          submitBtn.disabled = false;
          submitBtn.textContent = 'Complete Registration';
          
          // Remove processing message
          const processingMsg = document.querySelector('.processing-message');
          if (processingMsg) processingMsg.remove();
        }    
      });    

    } catch (error) {
      console.error("Firebase initialization error:", error);
      document.getElementById("emailError").textContent = "System error. Please try again later.";
      document.getElementById("emailError").style.display = "block";
    }
  </script>    
</body>    
</html>
